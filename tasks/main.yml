---
- name: Disable root password
  user:
    name: root
    update_password: always
    password: '!'

- name: Add user to Staff
  user: name={{ ansible_user|default(lookup('env', 'USER'), True) }} groups=staff append=yes

- name: Update apt cache
  apt: update_cache=yes

- name: Install aptitude
  apt: name=aptitude state=present

- name: Full upgrade
  apt: upgrade=full

- name: Install common packages
  apt:
    name: "{{ item }}"
    state: present
  with_items:
    - ufw
    - nano
    - vim
    - emacs
    - zip
    - unzip
    - subversion
    - git
    - ntp
    - man
    - open-vm-tools

- name: Setup Firewall
  import_tasks: firewall.yml

- name: Setup NTP
  import_tasks: ntp.yml

- name: Setup VIM
  import_tasks: vim.yml

- name: Setup Nano
  import_tasks: nano.yml

- name: Install SSL Certs
  import_tasks: ssl.yml

- name: Setup cron backup script
  copy: src=backup dest=/etc/cron.daily/backup force=no owner=root group=root mode=0755

- name: Create cron backup directory
  file: path=/etc/cron.daily/backup.d state=directory owner=root group=root mode=0755

- name: Setup Unattended Upgrades
  lineinfile: dest=/etc/apt/apt.conf.d/50unattended-upgrades regexp="{{ item.regexp }}" line="{{ item.line }}"
  with_items:
  - { regexp: '\$\{distro_codename\}-updates\"\;', line: '    "${distro_id}:${distro_codename}-updates";'         }
  - { regexp: 'InstallOnShutdown',                 line: 'Unattended-Upgrade::InstallOnShutdown "false";'         }
  - { regexp: 'Remove-Unused-Dependencies',        line: 'Unattended-Upgrade::Remove-Unused-Dependencies "true";' }
  - { regexp: 'Automatic-Reboot\s',                line: 'Unattended-Upgrade::Automatic-Reboot "true";'           }
  - { regexp: 'Automatic-Reboot-Time',             line: 'Unattended-Upgrade::Automatic-Reboot-Time "02:00";'     }
...
